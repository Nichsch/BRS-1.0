local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
acaD = Tunnel.getInterface("vrp_academia")
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VARIAVEIS
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
local academiaPagamento = false
local academiaMalhando = false
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- LOCAIS
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
local academiaExercicios = {
	{675.69,580.22,130.46, ['tipo'] = 1},
	{-1454.6334228516,-1050.8317871094,4.2489929199219, ['tipo'] = 1},
	{-1451.6811523438,-1052.4130859375,4.0230226516724, ['tipo'] = 1},
	{-1469.6088867188,-1067.8768310547,3.8818414211273, ['tipo'] = 1},

	{-1456.7395019531,-1054.0777587891,4.1483511924744, ['tipo'] = 2},
	{-1464.3728027344,-1063.7634277344,3.8212678432465, ['tipo'] = 2},
	{-1449.5092773438,-1054.4388427734,3.9290540218353, ['tipo'] = 2}, 
	-- Academia Praia
	{-1204.9020996094,-1560.6713867188,4.6136994361877, ['tipo'] = 1},
	{-1200.3397216797,-1564.0515136719,4.6175165176392, ['tipo'] = 1},	
	{-1195.9553222656,-1568.4362792969,4.6198329925537, ['tipo'] = 1},
	{-1201.6427001953,-1572.5531005859,4.6082062721252, ['tipo'] = 1},
	{-1207.4926757813,-1563.1616210938,4.6079292297363, ['tipo'] = 1},
}
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- EXERCICIOS
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
			Citizen.Wait(1)
			for k,v in ipairs(academiaExercicios) do
					local x,y,z = table.unpack(v)
					local pCoords = GetEntityCoords(GetPlayerPed(-1))
					local distance = GetDistanceBetweenCoords(pCoords.x, pCoords.y, pCoords.z, x,y,z, true)
					if distance < 5.0 then
						DrawText3d(x,y,z+0.5, "~w~Pressione ~g~[E]~w~ para começar o exercicio.~n~~w~Pressione ~g~[F]~w~ para parar de malhar.")
						DrawMarker(25,x,y,z-0.99,0,0,0,0,0,0,0.7,0.7,0.5,59, 206,48,100 ,0,0,2,0,0,0,0)
						if distance < 1.0 then

							if (IsControlJustPressed(1, 38)) then
									if academiaPagamento then
										if v.tipo == 1 then
											vRP.playAnim(false,{{"amb@world_human_push_ups@male@base","base"}},true)
											academiaMalhando = true
										elseif v.tipo == 2 then
											vRP.playAnim(false,{{"amb@prop_human_muscle_chin_ups@male@base","base"}},true)
											academiaMalhando = true
										end
									else
										TriggerEvent('chatMessage',"^2Você precisar pagar para treinar.")
									end
							end
							if (IsControlJustPressed(1, 145)) then
								vRP.stopAnim(false)
								academiaMalhando = false
								TriggerEvent("cancelando",false)
							end
						end
					end
			end
	end
end)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- PAGAR ACADEMIA
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
local academias = { {-1467.1166992188,-1056.7673339844,4.2990627288818}, {-1205.61,-1571.92,4.60} }
Citizen.CreateThread(function()
	while true do
			Citizen.Wait(1)
			for k,v in ipairs(academias) do
					local x,y,z = table.unpack(v)
					local pCoords = GetEntityCoords(GetPlayerPed(-1))
					local distance = GetDistanceBetweenCoords(pCoords.x, pCoords.y, pCoords.z, x,y,z, true)
					if distance < 15.0 then
						DrawText3d(x,y,z+0.5, "~r~[ACADEMIA]~w~~n~Valor: ~g~$2000~w~~n~Pressione ~g~[E] ~w~Para Pagar")
						DrawMarker(25,x,y,z-0.99,0,0,0,0,0,0,0.7,0.7,0.5,59, 206,48,100 ,0,0,2,0,0,0,0)
						if distance < 1.0 then
							if (IsControlJustPressed(1, 38)) then
								if acaD.checkPayment() then
									academiaPagamento = true
								end
							end
						end
					end
			end
	end
end)
RegisterNetEvent("NZK:cancelarAcademia") AddEventHandler("NZK:cancelarAcademia", function() academiaMalhando = false end)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- GANHAR EXP
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function() while true do Citizen.Wait(5000) if academiaMalhando then acaD.treinando() TriggerEvent("cancelando",true) else TriggerEvent("cancelando",false) end end end)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- FUNÇÃO
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function DrawText3d(x,y,z,text)
	local onScreen,_x,_y = World3dToScreen2d(x,y,z)
	SetTextFont(4)
	SetTextScale(0.35,0.35)
	SetTextColour(255,255,255,255)
	SetTextEntry("STRING")
	SetTextCentre(1)
	AddTextComponentString(text)
	DrawText(_x,_y)
end